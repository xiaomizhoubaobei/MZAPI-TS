name: 欢迎问候

on: [pull_request_target, issues]

permissions:
 contents: read

jobs:
 greeting:
  runs-on: ubuntu-latest
  permissions:
   issues: write
   pull-requests: write
  steps:
   - name: Harden the runner (Audit all outbound calls)
     uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
     with:
      egress-policy: audit

   - name: Audit - Workflow started
     run: |
       echo "Greetings workflow started" >> audit.log
       echo "Event type: ${{ github.event_name }}" >> audit.log
       if [ "${{ github.event_name }}" = "issues" ]; then
         echo "Issue number: ${{ github.event.issue.number }}" >> audit.log
         echo "Issue author: ${{ github.event.issue.user.login }}" >> audit.log
       elif [ "${{ github.event_name }}" = "pull_request_target" ]; then
         echo "PR number: ${{ github.event.pull_request.number }}" >> audit.log
         echo "PR author: ${{ github.event.pull_request.user.login }}" >> audit.log
       fi
       echo "Timestamp: $(date -u)" >> audit.log

   - uses: actions/first-interaction@1c4688942c71f71d4f5502a26ea67c331730fa4d # v3.1.0
     with:
       repo_token: ${{ secrets.GITHUB_TOKEN }}
       issue_message: |
         👋 感谢您提交首个 Issue！
         我们非常重视您的反馈，团队将尽快审核并回复。
       pr_message: |
         🎉 感谢您提交首个 Pull Request！
         我们感谢您的贡献，团队将尽快审核您的代码。
   - name: Audit - First interaction completed
     run: |
       echo "First interaction completed" >> audit.log
       echo "Event type: ${{ github.event_name }}" >> audit.log
       echo "Timestamp: $(date -u)" >> audit.log

   - name: Upload audit log
     uses: actions/upload-artifact@v5
     with:
       name: greetings-audit-log
       path: audit.log
       retention-days: 30